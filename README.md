# Keelboat

## About

KB1 is a simple ~6m monohull daysailer created to demonstrate the
[Shipshape](https://github.com/shipshape-marine/shipshape) parametric
CAD library and the design setup of the
[Shipshape](https://github.com/shipshape-marine) organization.
The entire boat—hull, deck, keel, rudder, rig—is generated from
a single set of parameters, with all geometry, analysis, and
documentation produced automatically.

**Website:** [shipshape-marine.github.io/keelboat](https://shipshape-marine.github.io/keelboat/)

## How this repo works

The boat model specified in this repo is available at
[shipshape-marine.github.io/keelboat](https://shipshape-marine.github.io/keelboat/).
Changes in the boat specs here are automatically reflected in the website.

The boat design is programmed in Python.
Design-specific components live in `src/` while boat-independent analysis is provided by the [shipshape](https://github.com/shipshape-marine/shipshape) library. Features include:
- Parameters: The boat is fully parameterized; the file [`constant/boat/kb1.json`](https://github.com/shipshape-marine/keelboat/blob/main/constant/boat/kb1.json) lets you choose the size of all components. Keelboat-specific derived parameters are computed by [`src/parameter/compute.py`](https://github.com/shipshape-marine/keelboat/blob/main/src/parameter/compute.py), loaded as a plugin by `shipshape.parameter`.
- Configurations: Sail and rudder settings are specified in [`constant/configuration/upwind.json`](https://github.com/shipshape-marine/keelboat/blob/main/constant/configuration/upwind.json).
- Design: The FreeCAD geometry is generated by [`src/design/main.py`](https://github.com/shipshape-marine/keelboat/blob/main/src/design/main.py), which builds hull, deck, keel, rudder, and rig from the computed parameters.

### Repo structure

```
src/
  parameter/compute.py   Keelboat-specific derived parameter calculations
  design/                FreeCAD geometry generation
  color/                 Apply colors to FreeCAD models
  render/                Render images from FreeCAD
  lines/                 Generate lines plan drawings
constant/
  boat/                  Boat specification (kb1.json)
  configuration/         Sail/rudder configuration (upwind.json)
  material/              Material properties (keelboat.json)
docs/                    Jekyll website (GitHub Pages)
```

Analysis is provided by [shipshape](https://github.com/shipshape-marine/shipshape): parameter computation, mass analysis, buoyancy equilibrium, and GZ curves.

### Pipeline

```
parameter → design → color → mass → buoyancy → gz
                 ↓                              ↓
              render                         GZ curve
                 ↓
              lines → lines-pdf
```

## Getting Started

0. Install `git` and `make`:
- **Linux**: `sudo apt install git make` (Ubuntu/Debian) or `sudo dnf install git make` (Fedora/RHEL)
- **macOS**: [Install Git](https://git-scm.com/install/mac), then run `xcode-select --install` for `make`
- **Windows**: [Git for Windows](https://git-scm.com/download/win) (includes Git Bash with `make`)

1. Clone this repository with `git clone git@github.com:shipshape-marine/keelboat.git`

2. Install [FreeCAD](https://www.freecad.org/)

3. Generate the boat:
```bash
make all         # full pipeline: parameter → design → mass → buoyancy → gz
make color       # apply color scheme
make render      # generate PNG renders (requires color)
make lines       # generate lines plan SVGs (requires design)
make lines-pdf   # compile lines plan LaTeX to PDF
```

4. View the website locally:
```bash
make sync-docs   # copy artifacts to docs/
make localhost   # serve website at localhost:4000
```

The generated files are placed in the folder `artifact`, for example:
```
artifact/kb1.upwind.design.FCStd
artifact/kb1.upwind.color.FCStd
artifact/kb1.upwind.lines.pdf
```

## Continuous Integration/Continuous Deployment (CICD)

When we change the boat specs, all affected artifacts need to be
regenerated: the designs, renderings, lines plans, and website.
CICD takes care of that automatically. This is done locally using
the `make` facility and on the GitHub server using a workflow. The
workflow makes sure that the
[website](https://shipshape-marine.github.io/keelboat/) always
has the latest versions.

## Under the hood

Crucial for the CICD approach to CAD using FreeCAD is:
- FreeCAD's [macros](https://wiki.freecad.org/Macros) feature
- the ability to run FreeCAD headlessly (without GUI), using `freecadcmd` on Linux and using `--console` on Mac
- this [observation](https://forum.freecad.org/viewtopic.php?p=857226#p857226) by FreeCAD user [`jcsahnwaldt`](https://forum.freecad.org/memberlist.php?mode=viewprofile&u=85580&sid=a9af5bd37412a3771f25378b4c027a2c) to use GUI features in headless FreeCAD with `PySide.QtGui`

Some design decisions:
- Toolchain automation with [`make`](<https://en.wikipedia.org/wiki/Make_(software)>) using this [Makefile](https://github.com/shipshape-marine/keelboat/blob/main/Makefile)
- Website generation using [Jekyll](<https://en.wikipedia.org/wiki/Jekyll_(software)>)
- JSON statistics generated by headless FreeCAD
- Rendering by headless FreeCAD using [`jcsahnwaldt`](https://github.com/jcsahnwaldt)'s observation

## Further development

Let's explore what output formats we can generate and what tools are available to get the most out of our FreeCAD designs. Any contributions are welcome.
